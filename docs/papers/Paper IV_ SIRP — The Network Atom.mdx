---
title: 'Paper IV: SIRP — The Network Atom'
date: '2026-01-05'
lastmod: '2026-01-05'
tags: ['sirp', 'network', 'routing', 'semantic-intent', 'overlay-network', 'did', 'cryptographic-receipt']
draft: false
summary: 'Semantic Intent Routing Protocol for location-independent agent communication. Routes messages based on Cryptographic Identity (DID) and Semantic Intent, transforming routing from a sunk cost into a verifiable economic activity through the Cryptographic Receipt Protocol.'
images: ['/static/images/papers/paper-iv-sirp-cover.jpg']
bibliography: 'references-logline.bib'
authors: ['default']
layout: 'PostLayout'
canonicalUrl: 'https://papers.logline.foundation/blog/paper-iv-sirp'
---

# Paper IV: SIRP — The Network Atom

**Dan Voulez¹ LogLine Foundation²**

¹Independent Researcher, Lisbon, Portugal  
²LogLine Foundation, Lisbon, Portugal

## 1.0 Abstract

SIRP (Semantic Intent Routing Protocol) defines the communication substrate for the verifiable agent economy. It is an application-layer overlay network designed to resolve the fundamental mismatch between the ephemeral nature of IP-based networking and the permanent, accountable requirements of autonomous economic agents.

Standard protocols like TCP/IP couple identity to topological location (`IP:Port`) and treat packet delivery as a "best-effort," unaccountable event. SIRP inverts this model. It routes messages based on Cryptographic Identity (DID) and Semantic Intent, utilizing a content-addressed "Capsule" as the atomic unit of transport. Furthermore, it transforms routing from a sunk cost into a verifiable economic activity through the Cryptographic Receipt Protocol, enabling a decentralized, incentivized relay market. Location becomes irrelevant. Identity becomes absolute.

This paper details the binary specification of the SIRP Capsule, the "Zero Silicon" Transport Abstraction Layer (TAL), the DHT-based discovery architecture, and the formal verification of packet delivery.

## 2.0 The Problem: The Location Trap

### 2.1 The Fragility of Topological Identity

The internet's current architecture binds an entity's identity to its network location. This creates three critical failure modes for autonomous agents:
1. **Mobility Failure:** An agent on a mobile device changes networks (Wi-Fi $\to$ 5G), altering its IP address. This breaks all active TCP connections, invalidating sessions and disrupting long-running economic transactions.
2. **Middlebox Opacity:** The proliferation of Carrier-Grade NAT (CGNAT) and firewalls creates a topology where agents can make outbound requests but are unreachable for inbound commands without centralized, trusted intermediaries.
3. **Accountability Void:** IP packets are fungible and "best-effort." There is no native protocol mechanism to prove that a specific packet was delivered, processed, or routed by a specific intermediary. In an economy of value, "I think I sent it" is insufficient.

### 2.2 The Solution: Zero Location Networking

SIRP establishes a "Zero Location" architecture where:
- **Identity is Absolute:** Addressing is done via Decentralized Identifiers (DIDs), e.g., `did:logline:agent:alice`. This identifier remains constant regardless of network topology.
- **Routing is Semantic:** The network routes based on what the data is (Intent) and who it is for, dynamically resolving the path via a Distributed Hash Table (DHT).
- **Transport is Verifiable:** Every hop in the network generates a cryptographic proof of service (Receipt), linking the transport layer directly to the economic layer.

## 3.0 Specification: The SIRP Capsule

The Capsule is the atomic unit of the SIRP network. Unlike a TCP packet, which is a transient stream of bytes, a Capsule is a self-contained, immutable, and cryptographically verifiable object.

### 3.1 The Wire Format Specification

The Capsule utilizes a binary packing format optimized for zero-copy parsing and high-speed validation. All integers are Big-Endian.

| Field | Offset | Size (Bytes) | Type | Description |
| :--- | :--- | :--- | :--- | :--- |
| **`MAGIC`** | 0 | 2 | `u16` | **Protocol ID:** `0x5199`. Fast rejection of non-SIRP traffic. |
| **`VER`** | 2 | 1 | `u8` | **Version:** Current `0x01`. Enables protocol evolution. |
| **`FLAGS`** | 3 | 1 | `u8` | Bitmask: `0x01` (Encrypted), `0x02` (Receipt Req), `0x04` (Priority). |
| **`TTL`** | 4 | 1 | `u8` | **Time-To-Live:** Max hop count (default 64) to prevent routing loops. |
| **`CID`** | 5 | 32 | `[u8;32]` | **Content ID:** BLAKE3 hash of `PAYLOAD`. Used for deduplication and addressing. |
| **`INTENT`** | 37 | 8 | `u64` | **Semantic Hash:** First 64-bits of `BLAKE3("namespace.action")`. e.g., `ubl.transact`. Allows routing logic to prioritize traffic types without decryption. |
| **`TS`** | 45 | 8 | `u64` | **Timestamp:** UTC Nanoseconds. Enforces strict replay protection windows. |
| **`LEN`** | 53 | 4 | `u32` | **Length:** Size of the Payload in bytes. |
| **`SIG`** | 57 | 64 | `[u8;64]` | **Signature:** Ed25519 signature of `Header[0..57] + PAYLOAD`. Proves authorship and integrity. |
| **`PAYLOAD`** | 121 | Variable | `Bytes` | The encrypted data body (typically `CipherEnvelope`). |

### 3.2 Security Invariants

1. **Envelope Integrity:** The `SIG` field covers the immutable header (including `CID`, `TS`, `INTENT`) and the payload. Any bit-flip by a middlebox invalidates the packet instantly.
2. **Stateless Replay Protection:** Nodes maintain a sliding window Bloom Filter of `(CID, TS)` pairs. Capsules with timestamps outside the validity window ($\pm$30s) or with previously seen CIDs are dropped at the edge, mitigating DoS replay attacks without requiring persistent state.
3. **Blind Prioritization:** The `INTENT` field enables "Smart Routing." A relay can prioritize `ubl.alert` (Critical) over `stream.video` (Bulk) based on policy, even though the payload remains fully encrypted.

## 4.0 The Network Architecture

### 4.1 Discovery: The Modified Kademlia DHT

SIRP utilizes a modified implementation of the Kademlia Distributed Hash Table for peer discovery and routing resolution.
- **Node ID:** `SHA256(DID_PublicKey)`. This cryptographically binds the network address to the agent's identity.
- **Keyspace:** 256-bit flat address space. XOR metric for distance calculation.
- **Values:** Stored records are signed "Peer Descriptors":
  ```json
  {
    "did": "did:logline:agent:alice",
    "endpoints": ["udp://203.0.113.5:9000", "wss://relay.node.io/alice"],
    "relay_did": "did:logline:relay:gamma",
    "ts": 1704456000,
    "sig": "ed25519:..."
  }
  ```
When Agent A wants to message Agent B, it queries the DHT for `Hash(B.did)`. The network returns B's most recent signed Peer Descriptor, allowing A to connect directly or via B's designated relay.

### 4.2 Transport Layer Abstraction (TAL)

The Transport Layer Abstraction (TAL) allows SIRP to function as a "Protocol Chameleon." It rides on top of whatever is available.

**Driver Selection Logic:**
1. **UDP (Datagram):** Preferred. Lowest latency, minimal overhead. Used for direct P2P and high-throughput streams.
2. **QUIC:** Strategic. Used when multiplexing is required or when UDP is throttled but not blocked. Solves Head-of-Line blocking.
3. **WebSocket (WSS):** Fallback. Used for browser-based agents or traversing restrictive corporate firewalls (Port 443).
4. **TCP:** Legacy. Last resort fallback.

**"Zero Silicon" Principle:** By implementing the TAL in software (Rust/WASM), SIRP requires no specialized router hardware or OS kernel modifications. It runs in user-space on any device.

**Implementation Architecture:**
The TAL is implemented as a pluggable driver system. Each transport protocol (UDP, QUIC, WSS, TCP) is encapsulated in a driver that implements a common interface:

```rust
trait TransportDriver {
    fn send(&self, capsule: &Capsule, endpoint: &Endpoint) -> Result<()>;
    fn receive(&mut self) -> Result<Option<Capsule>>;
    fn connect(&mut self, endpoint: &Endpoint) -> Result<()>;
    fn disconnect(&mut self) -> Result<()>;
}
```

The SIRP runtime automatically selects the optimal driver based on:
- Network conditions (NAT type, firewall rules)
- Application requirements (latency vs. reliability)
- Endpoint capabilities (advertised in Peer Descriptor)

This abstraction enables SIRP to function seamlessly across heterogeneous network environments, from high-performance datacenters to constrained IoT devices.

## 5.0 The Economic Layer: Cryptographic Receipts

This section details the mechanism that transforms routing from a cost center into a verifiable market.

### 5.1 The Receipt Protocol Specification

Upon successfully validating and processing a Capsule, a receiving node must emit a Signed Receipt. This is a financial instrument.

**Receipt Schema:**
```json
{
  "type": "SIRP_RECEIPT_V1",
  "capsule_cid": "blake3:8f1e3c...", // Links to specific packet
  "sender_did": "did:logline:agent:alice",
  "receiver_did": "did:logline:node:relay_01",
  "ts_received": "2026-01-05T12:00:00.123Z",
  "metrics": {
    "latency_ingress_ms": 12, // Time from TS to TS_Received
    "verification_cost_us": 450 // Compute used for Ed25519 verify
  },
  "outcome": "FORWARDED", // or "DELIVERED", "DROPPED_TTL"
  "sig": "ed25519:..." // Receiver's signature
}
```

### 5.2 The Economic Feedback Loop

These receipts are ingested by the UBL Ledger (Paper VI) to drive the network economy:
1. **Micro-Settlement:** The sender creates a UBL transaction aggregating receipts.
   $$Payment = \sum (BaseFee + \alpha \cdot Latency^{-1} + \beta \cdot Compute)$$
   *Note:* Faster delivery (lower latency) earns a higher fee. This creates a competitive market where relays optimize for speed and reliability.
2. **Reputation Score:** The DHT uses receipt volume and quality to score nodes.
   - High uptime + Low latency = High Reputation = More Traffic = More Fees.
   - This incentivizes the organic growth of high-quality Relay Nodes.
   - Reputation is stored in the DHT as a signed, time-stamped record, preventing Sybil attacks.
3. **Provable Audit:** In the event of data loss, the sender holds a chain of receipts up to the point of failure. The last node to issue a receipt but fail to forward is mathematically identifiable as the point of failure. This enables:
   - **Insurance Claims:** Senders can prove loss and claim compensation.
   - **Network Diagnostics:** Identify and isolate problematic nodes.
   - **Legal Evidence:** Cryptographic proof of delivery or failure.

### 5.3 Receipt Aggregation and Batching

To minimize on-chain transaction costs, SIRP implements receipt batching:

**Batch Window:** Receipts are collected over a time window (e.g., 1 minute) or until a threshold is reached (e.g., 100 receipts).

**Merkle Tree Construction:** Receipts are organized into a Merkle tree, with the root hash committed to the UBL ledger. Individual receipts can be verified against the root without requiring full ledger access.

**Settlement Efficiency:** A single UBL transaction can settle thousands of routing receipts, reducing per-packet costs by orders of magnitude while maintaining full cryptographic accountability.

## 6.0 Performance Characteristics

### 6.1 Latency Analysis

SIRP's latency is dominated by three factors:

1. **DHT Lookup:** ~2-5ms (Kademlia routing, typically 3-5 hops)
2. **Capsule Validation:** ~0.1-0.5ms (Ed25519 signature verification)
3. **Transport Overhead:** ~1-3ms (UDP/QUIC/WSS encapsulation)

**Total End-to-End Latency:** ~5-10ms for direct P2P connections, ~15-30ms when routing through relays.

This compares favorably to:
- **TCP/IP Direct:** ~1-2ms (but requires stable IP addresses)
- **Tor:** ~300-500ms (multi-hop onion routing)
- **I2P:** ~500-1000ms (garlic routing with high redundancy)

### 6.2 Throughput Characteristics

**Capsule Processing Rate:** A single relay node can process 10,000-50,000 capsules per second, depending on:
- CPU performance (Ed25519 verification is CPU-bound)
- Network bandwidth
- Capsule size (payload length)

**Bottleneck Analysis:**
- **Signature Verification:** ~100μs per capsule (Ed25519)
- **DHT Queries:** ~2-5ms per lookup (amortized via caching)
- **Network I/O:** Depends on transport driver (UDP fastest, WSS slowest)

**Optimization Strategies:**
- Batch signature verification (parallel Ed25519)
- DHT result caching (TTL-based invalidation)
- Priority queues for high-value intents (`ubl.transact` vs `stream.video`)

## 7.0 Comparative Analysis: SIRP vs. Overlay Networks

To contextualize SIRP, we compare it against established overlay networks: Tor, I2P, and libp2p.

| Feature | SIRP | libp2p | Tor | I2P |
| :--- | :--- | :--- | :--- | :--- |
| **Primary Design Goal** | **Accountability & Verifiability** | Modularity & P2P Tooling | Anonymity & Privacy | Anonymity & Resilience |
| **Addressing Model** | **Semantic Intent (DID+CID)** | Key-Based (PeerID) | Onion Layers | Garlic Routing |
| **Atomic Unit** | **Signed Capsule** | Frame / Stream | Cell (512 bytes) | Message |
| **Routing Economy** | **Receipt-Based Market** | None (Barter/Credit) | Volunteer | Volunteer |
| **Content Addressing** | **Native (CID in Header)** | Native (IPFS) | No | No |
| **Latency Overhead** | **Low (~5-10ms)** | Low (~3-5ms) | High (~300ms) | High (~500ms) |
| **NAT Traversal** | **Aggressive (TAL + Relays)** | Aggressive (Hole Punching) | TCP Tunnels | UDP/TCP Tunnels |
| **Economic Model** | **Incentivized Market** | Volunteer/Barter | Volunteer | Volunteer |
| **Verifiability** | **Cryptographic Receipts** | None | None | None |

**Strategic Differentiator:**
- Tor/I2P are designed to hide the participants. This creates high latency and makes economic attribution impossible.
- libp2p provides excellent P2P tooling but lacks accountability and economic incentives.
- SIRP is designed for economic agents. They generally want to be identified (to receive funds/services) but require location independence and secure routing. SIRP provides the Accountability that Tor explicitly removes, with the performance that libp2p provides, and the economic incentives that neither offers.

## 8.0 Integration with LogLine Ecosystem

SIRP is designed to integrate seamlessly with the broader LogLine architecture:

### 8.1 LogLine Protocol Integration

SIRP Capsules can carry LogLine events (Paper I) as payloads. The `INTENT` field enables semantic routing:
- `logline.event` → Route to LogLine validators
- `logline.consent` → Route to consent management systems
- `logline.ghost` → Route to abandoned intent handlers

### 8.2 TDLN Policy Integration

TDLN policies (Paper III) can be embedded in Capsule headers to enable "Policy-per-Packet" filtering:
- Relays can evaluate TDLN policies without decrypting payloads
- Enables network-level access control based on semantic intent
- Supports zero-trust networking at the protocol level

### 8.3 UBL Economic Integration

Receipts are automatically ingested into the UBL ledger (Paper VI):
- Micro-payments for routing services
- Reputation scoring for relay nodes
- Insurance claims for delivery failures
- Network analytics and optimization

### 8.4 Use Cases

**Mobile Agent Communication:**
An autonomous delivery agent moves between Wi-Fi and 5G networks. Its DID remains constant (`did:logline:agent:delivery_001`), and SIRP automatically updates its Peer Descriptor in the DHT. Other agents can reach it regardless of network topology.

**Financial Transaction Routing:**
A UBL transaction (Paper VI) is encapsulated in a SIRP Capsule with `INTENT=ubl.transact`. The network prioritizes this capsule over bulk traffic, routing it through high-reputation relays with low latency. Each relay generates a receipt, enabling micro-settlement and auditability.

**IoT Device Management:**
A fleet of IoT sensors behind CGNAT cannot receive inbound connections. SIRP enables bidirectional communication via relays, with each sensor maintaining a persistent connection to its designated relay. The relay forwards commands from the management system, and sensors send telemetry back through the same channel.

## 9.0 Conclusion: The Postal Service of Intent

SIRP represents the evolution of the network layer from a "dumb pipe" to a "smart, accountable substrate."

In the agent economy, the mere delivery of bits is insufficient. We require Proof of Delivery. We need a network that understands the difference between a video stream (High Bandwidth, Low Value) and a financial transaction (Low Bandwidth, Critical Value) and routes them accordingly.

SIRP achieves this by wrapping data in the Capsule, routing it via the DHT, and verifying it with Receipts. It ensures that the network provides a transparent, audited supply chain for digital intent. It acts as the "Postal Service" for the LogLine economy: guaranteed, tracked, and insured. Every packet is accounted for. Every hop is paid for. Every delivery is proven.

The protocol transforms networking from a cost center into a verifiable market, enabling the organic growth of a decentralized relay infrastructure that is both economically sustainable and cryptographically accountable.
